import{r as b,u as _,e as g,_ as v,o as l,c as u,a as t,t as c,b as f,v as m,F as y,f as x,D as w,p as D,h as U}from"./index-099da154.js";const I=b({updates:["1"],add(){this.updates.push("2")}}),$=_(),k=$.token,p=b({updates:[],async fetch(a){const s={headers:{Authorization:`Bearer ${k}`}};try{const o=await g.get(`/api/updates/${a}`,s);o.status===200&&(this.updates=o.data,console.log(o.data))}catch(o){console.log("Error fetching Updates: ",o)}}}),h=_(),S={computed:{store(){return I}},props:{incidentId:{type:[Number,String],required:!0}},data(){return{formdata:{shortDescription:"",updateText:""},token:h.token,userId:h.userId,username:h.user}},methods:{submitForm:async function(){const a={headers:{Authorization:`Bearer ${this.token}`}},s={...this.formdata,incidentId:this.incidentId,userId:this.userId,username:this.username};try{(await g.post("/api/updates/newUpdate",s,a)).status===201&&(this.formdata.shortDescription="",this.formdata.updateText="",await p.fetch(this.incidentId))}catch(o){console.log("Error sending data: ",o)}}}},T={class:"container-sm mt-3 border border-light-subtle rounded shadow p-4 d-flex flex-column"},B={class:"row g-2"},M={class:"form-floating"},N=t("label",{for:"shortDescription"},"Short description",-1),A=t("label",{for:"updateText"},"Updates",-1),F={class:"row mt-3"},z={class:"col"};function E(a,s,o,i,n,d){return l(),u("div",T,[t("div",B,[t("h3",null,"Log new Update to Incident No. "+c(o.incidentId),1),t("div",M,[t("form",null,[N,f(t("textarea",{class:"form-control",placeholder:"Describe in short why you update the Incident",id:"shortDescription",style:{height:"80px"},"onUpdate:modelValue":s[0]||(s[0]=e=>n.formdata.shortDescription=e)},`\r
        `,512),[[m,n.formdata.shortDescription]]),A,f(t("textarea",{class:"form-control",placeholder:"Describe in detail, what you made with incident",id:"updateText",style:{height:"100px"},"onUpdate:modelValue":s[1]||(s[1]=e=>n.formdata.updateText=e)},`\r
        `,512),[[m,n.formdata.updateText]])])])]),t("div",F,[t("div",z,[t("button",{class:"btn btn-info float-end",onClick:s[2]||(s[2]=e=>d.submitForm())},"Update")])])])}const et=v(S,[["render",E]]);const V=_(),q={name:"updatesByIncident",props:{incidentId:{type:[Number,String],required:!0}},mounted(){p.fetch(this.incidentId),this.intervalId=setInterval(()=>{this.fetchUpdates.fetch(this.incidentId)},6e4)},beforeUnmount(){clearInterval(this.intervalId)},computed:{fetchUpdates(){return p},store(){return I}},data(){return{token:V.token,intervalId:null}},methods:{getDate(a){const s=a,i=Date.now()-s,n=Math.floor(i/1e3/60/60/24),d=Math.floor(i/1e3/60/60),e=Math.floor(i/1e3/60),r=Math.floor(i/1e3);return n===1?n+" day ago":n>0?n+" days ago":d===1?d+" hour ago":d>1?d+" hours ago":e===1?e+" minute ago":e>1?e+" minutes ago":r>0?r+" seconds ago":"now"}}},C=a=>(D("data-v-e306818b"),a=a(),U(),a),L={class:"container-sm border border-light-subtle rounded shadow d-flex flex-column p-4 mt-3 mb-5"},R=C(()=>t("h3",null,"Recent Updates",-1)),j={class:"accordion",id:"updates"},G={class:"accordion-header"},H=["data-bs-target","aria-expanded","aria-controls"],J={class:"container"},K={class:"row"},O={class:"col"},P={class:"col text-center"},Q={class:"badge bg-success-subtle text-dark me-3"},W={class:""},X=["id","aria-labelledby"],Y={class:"accordion-body bg-success-subtle"};function Z(a,s,o,i,n,d){return l(),u("div",L,[R,t("div",j,[(l(!0),u(y,null,x(d.fetchUpdates.updates,(e,r)=>(l(),u("div",{class:"accordion-item",key:e.id},[t("h2",G,[t("button",{class:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse"+r,"aria-expanded":{true:r>0,false:r===0},"aria-controls":"collapse"+r},[t("div",J,[t("div",K,[t("div",O,c(e.shortDescription),1),t("div",P,[t("span",Q,c(e.username),1),t("strong",W,c(d.getDate(e.createdAt)),1)])])])],8,H)]),t("div",{id:"collapse"+r,class:w(["accordion-collapse collapse",{show:r===0}]),"aria-labelledby":"heading"+r,"data-bs-parent":"#updates"},[t("div",Y,c(e.updateText),1)],10,X)]))),128))])])}const st=v(q,[["render",Z],["__scopeId","data-v-e306818b"]]);export{et as S,st as a};
